<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.example.evcs.member.model.dao.MemberMapper">
	  <insert id="signUp">
		  INSERT INTO EV_MEMBER (
		    MEMBER_NO,
		    EMAIL,
		    MEMBER_PW,
		    MEMBER_NICKNAME
		  ) VALUES (
		    EV_MEMBER_SEQ_NO.NEXTVAL,
		    #{email},
		    #{memberPw},
		    #{memberNickname}
		  )
	</insert>
	
	<select id="isVerified">
		  SELECT CASE WHEN VERIFIED = 'Y' THEN 1 ELSE 0 END
		  FROM EV_EMAIL_VERIFICATION
		  WHERE EMAIL = #{email}
	</select>

	<select id="isVerifiedByPassword">
		  SELECT VERIFIED
		  FROM EV_PASSWORD_RESET_VERIFICATION
		  WHERE EMAIL = #{email}
	</select>
	
	
	<select id="getMemberByEmail">
		SELECT MEMBER_NO as memberNo,
		       EMAIL as email,
		       MEMBER_PW as memberPw,
		       EMAIL_VERIFIED as emailVerified,
		       MEMBER_NICKNAME as memberNickname,
		       ROLE as role,
		       CREATED_AT as createdAt
		FROM EV_MEMBER
		WHERE EMAIL = #{email}
	</select>

	
	
	<select id="getEmailVerificationStatus">
	    SELECT EMAIL_VERIFIED
	    FROM EV_MEMBER
	    WHERE EMAIL = #{email}
	</select>

   
   <update id="updatePassword">
   		UPDATE EV_MEMBER
   		SET MEMBER_PW = #{encodedPassword}
   		WHERE EMAIL = #{email}
   </update>
  
  <update id="changePassword">
  		UPDATE EV_MEMBER
  		SET MEMBER_PW = #{memberPw}
  		WHERE EMAIL = #{email}
  </update>
  
  
  </mapper>
  
  